CREATE TABLE users (
    id       BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    email    VARCHAR(255) NOT NULL UNIQUE,
    password VARCHAR(255) NOT NULL,
    nickname VARCHAR(255) NOT NULL
);

CREATE TABLE follows (
    id          BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    follower_id BIGINT NOT NULL,
    followee_id BIGINT NOT NULL,
    deleted_at  TIMESTAMP(6)
);

CREATE INDEX idx_follows_follower_followee_active ON follows(follower_id, followee_id) WHERE deleted_at IS NULL;
CREATE INDEX idx_follows_followee_active ON follows(followee_id) WHERE deleted_at IS NULL;

CREATE TABLE follow_counts (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    user_id         BIGINT NOT NULL UNIQUE,
    followers_count BIGINT NOT NULL,
    followees_count BIGINT NOT NULL
);